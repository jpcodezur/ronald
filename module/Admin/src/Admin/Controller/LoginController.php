<?phpnamespace Admin\Controller;use Zend\Mvc\Controller\AbstractActionController;use Zend\View\Model\ViewModel;use Admin\Form\Login\Login;use Admin\Form\Login\LoginValidator;use Admin\Model\Dao\IUsuarioDao;use Admin\Model\Login as LoginService;use Zend\Session\Container;class LoginController extends AbstractActionController {    private $usuarioDao;    private $login;    public function setLogin(LoginService $login) {        $this->login = $login;    }    public function setUsuarioDao(IUsuarioDao $usuarioDao) {        $this->usuarioDao = $usuarioDao;    }    public function indexAction() {        if ($this->login->isLoggedIn()) {            return $this->redirect()->toRoute('admin', array(                        'controller' => 'index',                        'action' => 'index'            ));        }        $form = new Login("login");        $modeView = new ViewModel(array("form" => $form));        $this->layout()->setTemplate('admin/login/login.phtml');        return $modeView;    }    public function autenticarAction() {        if (!$this->request->isPost()) {            $this->redirect()->toRoute('admin', array('controller' => 'login'));        }        $form = new Login("Login");        $form->setInputFilter(new LoginValidator());        $data = $this->request->getPost();        $form->setData($data);        if (!$form->isValid()) {            $modeView = new ViewModel(array("form" => $form));            $this->layout()->setTemplate('Admin/login/login.phtml');            return $modeView;        }        $values = $form->getData();        $email = $values["nombre"];        $password = $values["clave"];        $this->usuarioDao = $this->getServiceLocator()->get('UsuarioDao');        $this->login->login($email, $password);        if ($this->login->isLoggedIn()) {            $miSession = new Container('miSession');            $usuario = $this->usuarioDao->obtenerCuenta($email, $password);            if (!isset($miSession->usuario))                $miSession->usuario = $usuario;            $this->layout()->mensaje = "LoginCorrecto!!!";            $this->layout()->colorMensaje = "green";            return $this->redirect()->toRoute('admin', array(                        'controller' => 'index',                        'action' => 'index'            ));        } else {            return $this->redirect()->toRoute('admin', array(                        'controller' => 'login',                        'action' => 'index'            ));        }    }    public function logoutAction() {        $this->login->logout();        return $this->redirect()->toRoute('admin', array('controller' => 'login', 'action' => 'index'));    }}